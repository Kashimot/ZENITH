<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="admin_document_approval.css">
    <!-- Include jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Hamburger menu -->
    <div class="hamburger-menu">
        <div class="hamburger-icon"></div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2>Admin Menu</h2>
        <ul>
            <li><a href="admin_document_send_document.html" class="nav-btn">Send Document</a></li>
            <li><a href="admin_user_management.html" class="nav-btn">User Management</a></li>
            <li><a href="Documents_dashboard.html" class="nav-btn">View Documents</a></li>
            <li><a href="admin_send_notifications.html" class="nav-btn">Send Notification</a></li>
            <li><a href="admin_facility_manage.html" class="nav-btn">Manage Facility</a></li>
            <li><a href="admin_borrow_request.html" class="nav-btn">Borrow Request</a></li>
            <li><a href="admin_send_notifications.html" class="nav-btn">Send Notification</a></li>
            <li><a href="admin_facility_manage.html" class="nav-btn">Manage Facility</a></li>
            <li><a href="admin_dashboard.html" class="nav-btn">Home</a></li>
        </ul>
        <section class="logout-btn">
            <button class="nav-btn" onclick="window.location.href = 'login.php'">Logout</button>
        </section>
    </aside>

      <!-- Main content area -->
      <div class="main-content">

        <!-- Document list -->
        <ul id="documentList">
            <!-- Document items will be dynamically populated here -->
        </ul>
    </div>

    <!-- JavaScript for hamburger menu -->
    <script>
        $(document).ready(function() {
            $('.hamburger-icon').click(function() {
                $('.sidebar').toggleClass('active');
            });
        });
         // Function to fetch document content
         async function fetchDocumentContent(documentId) {
            try {
                const response = await fetch(`view_document.php?documentId=${documentId}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch document');
                }
                return await response.text();
            } catch (error) {
                console.error('Error fetching document:', error);
                throw error; // Rethrow the error for error handling in the calling function
            }
        }

        // Function to display document content
        function displayDocumentContent(content) {
            // Display the document in the UI
            alert('Document content: ' + content);
        }

        // Function to view document
        async function viewDocument(documentId) {
            try {
                const documentContent = await fetchDocumentContent(documentId);
                displayDocumentContent(documentContent);
            } catch (error) {
                // Handle error gracefully
                alert('Failed to view document. Please try again later.');
            }
        }

        // Function to reject document with comments
        async function rejectDocument(documentId) {
            const reason = prompt('Enter reason for rejection:');
            if (reason !== null && reason.trim() !== '') {
                try {
                    const response = await fetch('reject_document.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ documentId, reason })
                    });
                    if (!response.ok) {
                        throw new Error('Failed to reject document');
                    }
                    alert('Document rejected successfully.');
                } catch (error) {
                    console.error('Error rejecting document:', error);
                    alert('Failed to reject document. Please try again later.');
                }
            } else {
                alert('Please provide a reason for rejection.');
            }
        }

        $(document).ready(function() {
            // Function to populate document list
            function populateDocumentList() {
                $.ajax({
                    url: 'fetch_documents.php', // PHP script to fetch document list
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        $('#documentList').empty(); // Clear existing list
                        if (response.length > 0) {
                            response.forEach(function(document) {
                                var listItem = $('<li>');
                                listItem.text(document.name);
                                // Add buttons for approval, rejection, and viewing
                                var approveButton = $('<button class="approve-btn">Approve</button>');
                                var rejectButton = $('<button class="reject-btn">Reject</button>');
                                var viewButton = $('<button class="view-btn">View</button>');
                                listItem.append(approveButton);
                                listItem.append(rejectButton);
                                listItem.append(viewButton);
                                $('#documentList').append(listItem);
                            });
                        } else {
                            $('#documentList').append('<li>No documents found</li>');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error fetching document list:', error);
                    }
                });
            }

            // Populate document list on page load
            populateDocumentList();

            // Event listener for approving document
            $(document).on('click', '.approve-btn', function() {
                var documentName = $(this).closest('li').text();
                // Perform AJAX request to approve document
                // Update UI accordingly
            });

            // Event listener for rejecting document
            $(document).on('click', '.reject-btn', function() {
                var documentName = $(this).closest('li').text();
                var reason = prompt('Enter reason for rejection:');
                if (reason !== null && reason.trim() !== '') {
                    // Perform AJAX request to reject document with reason
                    // Update UI accordingly
                } else {
                    alert('Please provide a reason for rejection.');
                }
            });

            // Event listener for viewing document
            $(document).on('click', '.view-btn', function() {
                var documentId = $(this).closest('li').data('id');
                viewDocument(documentId);
            });
        });
    </script>
</body>
</html>
